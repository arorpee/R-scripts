######################################################################################################################################################
######################################################################################################################################################
######################################################################################################################################################
### Program Name:         

### Version:               1

### This program does:   

### Manual steps needed:   

### Authors:               Arora

### Original Date:       

### Ideas/To do:          
######################################################################################################################################################
######################################################################################################################################################
######################################################################################################################################################

### Settings: ########################################################################################################################################

rm(list=ls()) 


### Libraries: #######################################################################################################################################


library(RMySQL)


### DB connection: ###################################################################################################################################


### Open database connection:

drv <- dbDriver("MySQL")


### set the database to run this script on: 

Database <- "SOLACTIVE"  


con <- dbConnect(drv, user="parora", dbname=Database, host="127.0.0.1", password ="acCvefayMLay", port=3308)  #if not working try 3306, 3307, 3308 or look at:  system("netstat -an")


tt <- as.matrix(dbGetQuery(con, "select sedol, CHAR_LENGTH(sedol) 
                 from SOLACTIVE.T_MAPPING 
                           where sedol is not null and sedol <> 0"))


hist(as.numeric(tt[,2]))

head(tt)





###############################################################################################################################################

ID <- "22342"


sql1 <- paste("select * from SOLACTIVE.T_CA_CHANGE where id='", ID, "'", sep="") 
sql1

DB <- as.matrix(dbGetQuery(con, sql1))
DB




###############################################################################################################################################


sql2 <- paste("select id, isin, date, price from SOLACTIVE.T_BB_TEMP where id='", ID, "' order by date", sep="") 
sql2

TS <- as.matrix(dbGetQuery(con, sql2))
head(TS)



##############################################################

plot(as.POSIXlt(TS[, "date"]), 
     as.numeric(TS[, "price"]),
     pch=".", cex=1.5)


### all dates where price= 0:
tPos <- which(as.numeric(TS[, "price"])== 0)


###...mark them in red in the plot:
points(as.POSIXlt(TS[tPos, "date"]), 
       as.numeric(TS[tPos, "price"]), 
       col="red")


### max and min:
range(tPos)


TS[range(tPos), "date"]



DB

sql1

max(TS[, "date"])










#dbGetQuery(drv, 'SELECT MAX(DbId)+1 From T_BB_TEMP')





###############################################################################################################
