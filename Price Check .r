######################################################################################################################################################
######################################################################################################################################################
######################################################################################################################################################
### Program Name:         

### Version:               1

### This program does:   

### Manual steps needed:   

### Authors:               Arora

### Original Date:       

### Ideas/To do:          
######################################################################################################################################################
######################################################################################################################################################
######################################################################################################################################################

### Settings: ########################################################################################################################################

rm(list=ls()) 


### Libraries: #######################################################################################################################################

  
library(RMySQL)


### DB connection: ###################################################################################################################################


### Open database connection:

drv <- dbDriver("MySQL")


### set the database to run this script on: 

Database <- "SOLACTIVE"  


con <- dbConnect(drv, user="parora", dbname=Database, host="127.0.0.1", password ="acCvefayMLay", port=3307)  #if not working try 3306, 3307, 3308 or look at:  system("netstat -an")








###############################################################################################################

csv <- as.matrix(read.csv2("C:/Users/Arora Peeyush/Desktop/Copy of Stocks to be checked2.csv")) 
head(csv)
dim(csv)

DATE <- as.matrix(c("2015-07-20", "2016-05-18", "2016-07-11"))
DATE

### get ID for Ticker from  T_CA_CHANGE: ############################################################################################################

Erg <- matrix(NA, nrow(csv), 3)
for (i in 1:nrow(csv)){
  
    sql <- paste("select id, isin, bb from T_CA_CHANGE where BB='", csv[i, "Ticker"], "' and live=1", sep="")  
    sql
    
    
    temp <- as.matrix(dbGetQuery(con, sql))
    temp
    
    
   if (dim(temp)[1]!= 0){
        Erg[i, ] <- temp
    }  
    print(i)  
    
}
head(Erg)


Arora <- cbind(csv, Erg)       # cbind =column bind    ?cbind()
head(Arora)







write.csv2(Arora, "C:/Users/Arora Peeyush/Desktop/missingStock.csv")






